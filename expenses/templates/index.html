{% extends 'base.html' %}

{% block title %}Dashboard - Expensio{% endblock %}

{% block content %}

<div class="container mx-auto max-w-3xl px-4 py-6">

    <div class="flex justify-between items-center mb-6">
        <div>
            <h2 class="text-xl font-bold text-white">Dashboard ðŸ“Š</h2>
            <p class="text-gray-400 text-xs">Welcome back!</p>
        </div>

        <form method="GET" action="{% url 'index' %}" id="filterForm">
            <div class="relative">
                <select name="month" onchange="document.getElementById('filterForm').submit();" 
                        class="bg-green-600 text-white text-xs font-bold rounded-lg py-2 pl-3 pr-8 focus:outline-none appearance-none cursor-pointer hover:bg-green-700 transition shadow-md border-0">
                    
                    <option value="" class="bg-gray-800" {% if not filter_month %}selected{% endif %}>All Time</option>
                    
                    {% for month in available_months %}
                        <option value="{{ month|date:'Y-m-d' }}" class="bg-gray-800" 
                                {% if filter_month == month|date:'Y-m-d' %}selected{% endif %}>
                            {{ month|date:"M Y" }}
                        </option>
                    {% endfor %}
                </select>
                <span class="absolute right-2 top-2 text-white pointer-events-none text-[10px]">â–¼</span>
            </div>
        </form>
    </div>

    <div class="grid grid-cols-3 gap-3 mb-8">
        
        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4 flex flex-col justify-center">
            <p class="text-gray-500 text-[10px] uppercase tracking-wider font-semibold">Income</p>
            <p class="text-green-500 font-bold text-lg mt-1 truncate">â‚¹{{ total_income }}</p>
        </div>

        <div class="bg-gray-900 border border-gray-800 rounded-xl p-4 flex flex-col justify-center">
            <p class="text-gray-500 text-[10px] uppercase tracking-wider font-semibold">Expense</p>
            <p class="text-red-500 font-bold text-lg mt-1 truncate">â‚¹{{ total_expense }}</p>
        </div>

        <div class="bg-gray-800 border border-gray-700 rounded-xl p-4 flex flex-col justify-center shadow-lg">
            <p class="text-gray-400 text-[10px] uppercase tracking-wider font-semibold">Balance</p>
            <p class="text-blue-400 font-bold text-lg mt-1 truncate">â‚¹{{ balance }}</p>
        </div>

    </div>

    <div class="flex justify-between items-end mb-3">
        <h3 class="text-sm font-bold text-gray-300">Recent Transactions</h3>
        
        <div class="flex gap-3">
            <a href="{% url 'add_category' %}" class="text-xs text-gray-500 hover:text-white transition">+ Category</a>
            <a href="{% url 'add_transaction' %}" class="text-xs text-green-500 hover:text-green-400 font-bold transition">+ New Transaction</a>
        </div>
    </div>

    <div class="bg-gray-900 border border-gray-800 rounded-xl overflow-hidden">
        
        {% for t in transactions %}
        <div class="flex justify-between items-center py-3 px-4 border-b border-gray-800 last:border-0 hover:bg-gray-800/50 transition cursor-default">
            
            <div class="flex items-center gap-3">
                {% if t.category.type == 'Income' %}
                    <div class="w-8 h-8 rounded-lg bg-green-900/20 text-green-500 flex items-center justify-center text-xs font-bold">â†—</div>
                {% else %}
                    <div class="w-8 h-8 rounded-lg bg-red-900/20 text-red-500 flex items-center justify-center text-xs font-bold">â†˜</div>
                {% endif %}

                <div>
                    <p class="text-white text-sm font-medium">{{ t.category.name }}</p>
                    <p class="text-[10px] text-gray-500">{{ t.date|date:"M d" }}</p>
                </div>
            </div>

            <div class="text-right">
                {% if t.category.type == 'Income' %}
                    <p class="font-bold text-sm text-green-500">+{{ t.amount }}</p>
                {% else %}
                    <p class="font-bold text-sm text-red-500">-{{ t.amount }}</p>
                {% endif %}
            </div>

        </div>
        
        {% empty %}
        <div class="text-center py-8">
            <p class="text-gray-600 text-xs">No transactions found.</p>
            <a href="{% url 'add_transaction' %}" class="text-green-500 text-xs font-bold mt-2 inline-block hover:underline">Add your first one</a>
        </div>
        {% endfor %}

    </div>

</div>

{% endblock %}